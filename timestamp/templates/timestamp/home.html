<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pee & Poo Logger</title>
    <style>
        body { font-family: system-ui, sans-serif; text-align: center; padding: 40px; background: #f4f4f4; }
        h1 { margin-bottom: 50px; }
        .buttons { margin: 60px 0; }
        button {
            font-size: 3rem;
            padding: 40px 80px;
            margin: 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            min-width: 250px;
        }
        .pee { background: #ffeb3b; }   /* yellow */
        .poo { background: #8b4513; color: white; } /* brown */
        .log { margin-top: 60px; }
        .entry { padding: 8px; font-size: 1.2rem; }
        .pee-entry { color: #b8860b; }
        .poo-entry { color: #654321; }
    </style>
</head>
<body>
    <h1>ðŸš½ Bathroom Logger ðŸš½</h1>

    <div class="buttons">
        <button onclick="log('pee')" class="pee">Pee</button>
        <button onclick="log('poo')" class="poo">Poo</button>
    </div>
    
    <div id="log" class="log">
        <h2>Recent activity</h2>
        {% include "timestamp/log_partial.html" %}
    </div>
    
    <script>
    async function log(action) {
        const btn = event.target;
        btn.disabled = true;                 // prevent double-tap
        btn.style.opacity = 0.6;
    
        await fetch("", {                   // "" = same URL
            method: "POST",
            headers: {
                "X-Requested-With": "XMLHttpRequest",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: new URLSearchParams({action})
        });
    
        // Reload only the log part
        const resp = await fetch("{{ request.path }}?partial=1");
        document.getElementById("log").innerHTML = await resp.text();
    
        btn.disabled = false;
        btn.style.opacity = 1;
    }
    </script>
    
    <div class="log">
        <h2>Recent activity (last 50)</h2>
        {% for entry in entries %}
            <div class="entry {% if entry.action == 'pee' %}pee-entry{% else %}poo-entry{% endif %}">
                {{ entry.timestamp|date:"Y-m-d H:i:s" }} â€” 
                {% if entry.action == 'pee' %}ðŸ’¦ Pee{% else %}ðŸ’© Poo{% endif %}
            </div>
        {% empty %}
            <p>No entries yet. Go ahead!</p>
        {% endfor %}
    </div>
</body>
</html>
