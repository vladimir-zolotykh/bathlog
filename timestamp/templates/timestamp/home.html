<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pee & Pill Logger</title>
    <style>
        body { font-family: system-ui, sans-serif; text-align: center; padding: 40px; background: #f4f4f4; }
        h1 { margin-bottom: 50px; }
        .buttons { margin: 60px 0; }
        button {
            font-size: 3rem;
            padding: 40px 80px;
            margin: 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            min-width: 40px;
        }
        .action-button { 
            font-size: 0.9rem;     /* was 1.2rem */
            padding: 1px 3px;      /* was 5px 10px */
            margin-left: 10px;     /* was 15px */
            border-radius: 4px;    /* was 5px */
            background: #f44336; 
            color: white; 
        }
        .pee { background: #ffeb3b; }        /* yellow */
        .pill { background: #4caf50; color: white; }  /* green pill */
        .log { margin-top: 40px; }
        .entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 14px;
            margin: 6px 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            line-height: 1.4;
            font-size: 1.05rem;
            height: 48px;               /* fixed short height */
            box-sizing: border-box;
        }        
        .pee-entry {color: #b8860b;}
        .pill-entry {color: #2e7d32;}
    </style>
</head>
<body>
    <h1>Pee & Pill Logger</h1>

    <div class="buttons">
        <button onclick="log('pee')" class="pee">Pee</button>
        <button onclick="log('pill')" class="pill">Pill</button>
    </div>
    
    <div id="log-container" class="log"> 
        <h2>Recent activity</h2>
        {% include "timestamp/log_partial.html" %}
    </div>
    
    <script>
    // Helper function to re-fetch and update the log list
    async function updateLogList() {
        // Fetch the updated log list fragment from log_list view
        const resp = await fetch("{% url 'log_list' %}?partial=1"); 
        
        // Replace the content of the log div with the new HTML fragment
        document.getElementById("log-container").innerHTML = await resp.text();
    }
    
    // Function for creating a new log entry (Pee/Pill)
    async function log(action) {
        const btn = event.target;
        btn.disabled = true;
        btn.style.opacity = 0.6;
        
        // --- STEP 1: POST to the new log_create URL (Creation) ---
        await fetch("{% url 'log_create' %}", {
            method: "POST",
            headers: {
                "X-Requested-With": "XMLHttpRequest", 
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: new URLSearchParams({action})
        });
        
        // --- STEP 2: Update the log list dynamically ---
        await updateLogList();
        
        btn.disabled = false;
        btn.style.opacity = 1;
    }

    // Function for removing a log entry
    async function removeLog(logId) {
        if (!confirm("Are you sure you want to delete this log entry?")) {
            return;
        }
        
        // --- STEP 1: POST (or DELETE) to the new log_delete URL ---
        // We will use POST here for simplicity with Django's CSRF token handling, 
        // passing the logId in the body, which will be handled by the log_delete view.
        await fetch("{% url 'log_delete' %}", {
            method: "POST",
            headers: {
                "X-Requested-With": "XMLHttpRequest", 
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: new URLSearchParams({id: logId}) // Send the ID of the record to delete
        });

        // --- STEP 2: Update the log list dynamically ---
        await updateLogList();
    }
    </script>
    
    </body>
</html>
