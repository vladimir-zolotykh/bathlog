<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pee & Pill Logger</title>
    <style>
        body { font-family: system-ui, sans-serif; text-align: center; padding: 40px; background: #f4f4f4; }
        h1 { margin-bottom: 50px; }
        .buttons { margin: 60px 0; }
        button {
            font-size: 3rem;
            padding: 40px 80px;
            margin: 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            min-width: 250px;
        }
        .pee { background: #ffeb3b; }          /* yellow */
        .pill { background: #4caf50; color: white; }  /* green pill */
        .log { margin-top: 60px; }
        .entry { padding: 8px; font-size: 1.2rem; }
        .pee-entry { color: #b8860b; }
        .pill-entry { color: #2e7d32; }
    </style>
</head>
<body>
    <h1>Pee & Pill Logger</h1>

    <div class="buttons">
        <button onclick="log('pee')" class="pee">Pee</button>
        <button onclick="log('pill')" class="pill">Pill</button>
    </div>
    
    <div id="log" class="log">
        <h2>Recent activity</h2>
        {% include "timestamp/log_partial.html" %}
    </div>
    
    <script>
    async function log(action) {
        const btn = event.target;
        btn.disabled = true;
        btn.style.opacity = 0.6;
        
        // --- STEP 1: POST to the new log_create URL ---
        await fetch("{% url 'log_create' %}", {
            method: "POST",
            headers: {
                // Note: X-Requested-With and X-CSRFToken are still required for AJAX/Django
                "X-Requested-With": "XMLHttpRequest", 
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: new URLSearchParams({action})
        });
        
        // --- STEP 2: GET the updated log list fragment from log_list view ---
        // Note: 'log_list' is the name you set in your timestamp/urls.py for the root path ""
        const resp = await fetch("{% url 'log_list' %}?partial=1"); 
        
        // Replace the content of the log div with the new HTML fragment
        document.getElementById("log").innerHTML = await resp.text();
        
        btn.disabled = false;
        btn.style.opacity = 1;
    }
    </script>
        
    <div class="log">
        <h2>Recent activity (last 50)</h2>
        {% for entry in entries %}
            <div class="entry {% if entry.action == 'pee' %}pee-entry{% else %}pill-entry{% endif %}">
                {{ entry.timestamp|date:"Y-m-d H:i:s" }} â€” 
                {% if entry.action == 'pee' %}Pee{% else %}Pill{% endif %}
            </div>
        {% empty %}
            <p>No entries yet. Go ahead!</p>
        {% endfor %}
    </div>
</body>
</html>
